---
import { getCollection } from "astro:content";
import TopNav from "../components/TopNav.astro";
import CookieBanner from "../components/CookieBanner.astro";

const siteTitle = "Il Blog di Lujanta";
const tagline =
  "Tradizioni, Folklore e Stregoneria\nnelle Culture Alpine e nei loro intrecci Europei nel Tempo";

// Prendo tutti gli articoli, ordino dal più recente e tengo i primi 9
const articoli = (await getCollection("articoli"))
  .slice()
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const top9 = articoli.slice(0, 9);

// ✅ GA4
const GA_ID = "G-4QEGKF1RX0";
const CONSENT_KEY = "cookie_consent_v1";
---

<!doctype html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{siteTitle}</title>

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <!-- GTranslate (UNA SOLA VOLTA per pagina) -->
    <script is:inline>
      window.gtranslateSettings = {
        default_language: "it",
        native_language_names: true,
        detect_browser_language: true,
        languages: ["it", "de", "en", "fr"],
        wrapper_selector: ".gtranslate_wrapper"
      };
    </script>
    <script src="https://cdn.gtranslate.net/widgets/latest/lc.js" defer></script>

    <!-- ✅ Google tag SEMPRE presente (così Analytics lo rileva) -->
    <script async src={"https://www.googletagmanager.com/gtag/js?id=" + GA_ID}></script>

    <!-- ✅ Consent Mode: default NEGATO, abilita e invia page_view solo dopo consenso -->
    <script is:inline define:vars={{ GA_ID, CONSENT_KEY }}>
      (function () {
        window.dataLayer = window.dataLayer || [];
        function gtag(){ window.dataLayer.push(arguments); }
        window.gtag = gtag;

        gtag("js", new Date());

        // default: niente analytics finché non c’è consenso
        gtag("consent", "default", {
          analytics_storage: "denied",
          ad_storage: "denied",
          ad_user_data: "denied",
          ad_personalization: "denied"
        });

        // config senza page_view automatico (lo inviamo solo dopo consenso)
        gtag("config", GA_ID, {
          anonymize_ip: true,
          send_page_view: false
        });

        function sendPageView(){
          gtag("event", "page_view", {
            page_title: document.title,
            page_location: location.href,
            page_path: location.pathname + location.search
          });
        }

        function enableAnalytics(){
          gtag("consent", "update", { analytics_storage: "granted" });
          sendPageView();
        }

        // se già accettato in passato
        try{
          const consent = localStorage.getItem(CONSENT_KEY);
          if(consent === "accepted") enableAnalytics();
        }catch(e){}

        // quando l’utente accetta dal banner
        window.addEventListener("cookie:consent", (ev) => {
          if(ev.detail === "accepted") enableAnalytics();
        });
      })();
    </script>

    <style>
      :root{
        --ink:#2b2a26;
        --paper: rgba(244,241,234,.78);
        --border: rgba(43,42,38,.35);
      }

      body{
        margin:0;
        font-family: "Baskerville Old Face","Baskerville","Libre Baskerville",Georgia,"Times New Roman",serif;
        color:var(--ink);
      }

      /* ===== HERO (cresce con il contenuto) ===== */
      .hero{
        min-height: 100vh;
        position: relative;
        overflow: hidden;
        display: block;
        padding: 110px 0 80px; /* spazio per menu + respiro */
      }

      .hero__bg{
        position:absolute; inset:0;
        background-image: url("/hero.jpg");
        background-size: cover;
        background-position: top center;
        background-repeat: no-repeat;
        transform: none;
        z-index: 0;
      }

      .hero__veil{
        position:absolute;
        inset:0;
        background: linear-gradient(
          to bottom,
          rgba(244,241,234,0.10),
          rgba(244,241,234,0.82) 70%,
          rgba(244,241,234,0.92)
        );
        z-index: 1;
      }

      .hero__content{
        position: relative;
        z-index: 2;
        width: min(980px, 92vw);
        margin: 0 auto;
        text-align: center;
        padding: 0 1rem;
        margin-top: 200px;
      }

      .hero-logo img{
        width: clamp(350px, 16vw, 380px);
        height: auto;
        mix-blend-mode: multiply;
        filter:
          contrast(1.05)
          brightness(0.95)
          drop-shadow(0 0 8px rgba(244,241,234,0.55))
          drop-shadow(0 0 18px rgba(200,190,160,0.35));
        opacity: 0.96;
      }

      h1{
        margin: 0 0 1rem;
        font-size: clamp(2.2rem, 5vw, 3.6rem);
        font-weight: 600;
      }

      .tagline{
        margin: 0 auto 1.4rem auto;
        max-width: 62ch;
        font-size: clamp(1rem, 1.6vw, 1.15rem);
        line-height: 1.8;
        white-space: pre-line;
      }

      .cta{
        display:inline-block;
        padding: .7rem 1.3rem;
        border: 1px solid var(--border);
        background: rgba(244,241,234,.55);
        color: inherit;
        text-decoration: none;
      }
      .cta:hover{ background: rgba(244,241,234,.8); }

      .rule{
        margin: 1.6rem auto 0 auto;
        width: min(520px, 80vw);
        height: 1px;
        background: var(--border);
      }

      /* ===== SCOPERTE CONSIGLIATE ===== */
      .discoveries{
        margin: 70px auto 0;
        text-align: center;
      }

      .discoveries h2{
        margin: 0 0 10px;
        font-size: clamp(2rem, 4vw, 3rem);
        font-weight: 500;
      }

      .discoveries .sub{
        margin: 0 auto 40px;
        max-width: 60ch;
        font-size: 1.2rem;
        opacity: .9;
      }

      .discoveries-grid{
        display: grid;
        grid-template-columns: 1fr;
        gap: 26px;
        align-items: start;
      }

      @media (min-width: 860px){
        .discoveries-grid{
          grid-template-columns: 1.7fr 1fr;
          gap: 34px;
          text-align: left;
        }
        .discoveries{ text-align: left; }
        .discoveries .sub{ margin-left: 0; }
      }

      .card{
        border: 1px solid rgba(43,42,38,.25);
        background: rgba(255,255,255,.28);
        box-shadow: 0 10px 30px rgba(0,0,0,.08);
        border-radius: 4px;
        padding: 22px;
      }

      .card h3{
        margin: 0 0 16px;
        font-size: 1.5rem;
        font-weight: 500;
      }

      .pick-grid{
        display: grid;
        grid-template-columns: repeat(1, 1fr);
        gap: 14px;
      }
      @media (min-width: 560px){
        .pick-grid{ grid-template-columns: repeat(2, 1fr); }
      }
      @media (min-width: 980px){
        .pick-grid{ grid-template-columns: repeat(3, 1fr); }
      }

      .pick{
        display: block;
        text-decoration: none;
        color: inherit;
        padding: 14px 14px;
        border: 1px solid rgba(43,42,38,.20);
        background: rgba(244,241,234,.35);
        border-radius: 4px;
      }
      .pick:hover{ background: rgba(244,241,234,.60); }

      .pick .t{
        font-size: 1.15rem;
        margin: 0 0 8px;
        font-weight: 500;
      }
      .pick .y{
        margin: 0;
        opacity: .8;
      }

      .pick img.thumb{
        width: 100%;
        height: 120px;
        object-fit: cover;
        border-radius: 4px;
        margin-bottom: 10px;
        box-shadow: 0 6px 14px rgba(0,0,0,.15);
      }

      .icon-link{
        display:flex;
        align-items:center;
        gap:10px;
      }

      .icon-link svg{
        width:18px;
        height:18px;
        stroke: currentColor;
        stroke-width:1.6;
        fill:none;
        opacity:.85;
      }

      .top-list a{
        display: block;
        text-decoration: none;
        color: inherit;
        padding: 10px 0;
        border-top: 1px solid rgba(43,42,38,.18);
      }
      .top-list a:first-child{ border-top: none; padding-top: 0; }
      .top-list a:hover{ text-decoration: underline; }

      @media (max-width: 480px){
        .hero{ padding-top: 96px; }
      }

      /* ===== DISCLAIMER ===== */
      .site-disclaimer{
        margin-top: 0px;
        padding: 26px 16px;
        text-align: center;
        font-size: 14px;
        line-height: 1.6;
        opacity: .75;
        color: var(--ink);
      }

      .site-disclaimer .inner{
        max-width: 820px;
        margin: 0 auto;
        border-top: 1px solid rgba(43,42,38,.25);
        padding-top: 18px;
      }

      /* ===== HOME OVERRIDE: usa TopNav.astro ma con look identico alla home ===== */
      .topnav{
        position: fixed !important;
        top: 1rem !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
        width: min(980px, 92vw) !important;

        background: transparent !important;
        border-bottom: 0 !important;
        backdrop-filter: none !important;
        -webkit-backdrop-filter: none !important;
      }

      .topnav .inner{
        width: 100% !important;
        padding: .7rem 1rem !important;
      }

      .topnav .nav-left a{
        color: #2b2a26 !important;
        text-shadow: 0 1px 8px rgba(244,241,234,.9) !important;
        border-bottom-color: transparent !important;
      }
      .topnav .nav-left a:hover{
        text-decoration: underline;
        border-bottom-color: transparent !important;
      }

      .topnav .burger{
        border-color: rgba(43,42,38,.25) !important;
        background: rgba(244,241,234,.35) !important;
      }
      .topnav .burger span{
        background: rgba(43,42,38,.9) !important;
      }

      .topnav .nav-right{
        min-width: 90px !important;
      }

      @media (max-width: 860px){
        .hero__bg{ background-position: center 35%; }
        .hero{
          min-height: 88vh;
          padding-top: 96px;
          padding-bottom: 60px;
        }
        .hero__content{ margin-top: 120px; }
        h1, .tagline{
          text-shadow:
            0 2px 12px rgba(244,241,234,.9),
            0 1px 2px rgba(0,0,0,.15);
        }
      }
    </style>
  </head>

  <body>
    <TopNav />
    <CookieBanner />

    <main class="hero">
      <div class="hero__bg" role="img" aria-label="Copertina: paesaggio innevato del lago"></div>
      <div class="hero__veil"></div>

      <div class="hero__content">
        <div class="hero-logo" aria-hidden="true">
          <img src="/logo-lujanta.png" alt="" />
        </div>

        <h1>{siteTitle}</h1>
        <p class="tagline">{tagline}</p>
        <a class="cta" href="/inizio-da-qui">Inizia da qui</a>
        <div class="rule"></div>

        <section class="discoveries" aria-label="Ultimi articoli">
          <h2>Ultimi articoli</h2>
          <p class="sub"></p>

          <div class="discoveries-grid">
            <div class="card">
              <h3></h3>

              <div class="pick-grid">
                {top9.map((a) => (
                  <a class="pick" href={`/articoli/${a.slug}`}>
                    {a.data.cover && (
                      <img
                        class="thumb"
                        src={a.data.cover}
                        alt={a.data.title}
                        loading="lazy"
                      />
                    )}
                    <p class="t">{a.data.title}</p>
                    <p class="y">{a.data.date.getFullYear()}</p>
                  </a>
                ))}
              </div>
            </div>

            <aside class="card" aria-label="I più letti della settimana">
              <h3>I più letti della settimana</h3>
              <div class="top-list">
                <a href="/articoli/2016/242016-wielenberg-nel-nome-di-wielbeth-la-dea-lunare-una-delle-bethen-la-triade-di-dee-celtiche-delle-dolomiti-pust/">Wielenberg, nel nome di Wielbeth, la Dea Lunare: una delle Bethen, la Triade di Dee Celtiche delle Dolomiti Pusteresi</a>
                <a href="/articoli/2018/4-2018-il-burgkofel-di-lothen-il-luogo-del-cinturone-dellofferta-a-hepru/">Il Burgkofel di Lothen, il luogo del cinturone dell'Offerta a Hepru</a>
                <a href="/articoli/2016/18-2016-brigit-la-dea-serpente/">Brigit la Dea Serpente della Trasformazione e del Mutamento, della Conoscenza e della Fortuna</a>
                <a href="/articoli/2016/212016-se-del-due-non-fai-uno/">Se del Due non fai Uno</a>
                <a href="/articoli/2016/112016-trumusiate-sainate-la-divinità-del-santuario-di-lagole-calalzo-di-cadore-belluno/">Trumusiate Sainate, la Divinità del Santuario di Lagole</a>
                <a href="/articoli/2016/192016-bergfeuer-i-fuochi-solstiziali-preistorici-del-tirolo/">Bergfeuer, i Fuochi Solstiziali Preistorici del Tirol</a>
                <a href="/articoli/2016/162016-prologo-e-toponimi/">Prologo e toponimi</a>
              </div>

              <hr style="margin:24px 0; border:0; border-top:1px solid rgba(43,42,38,.18);" />

              <section aria-label="Contatti">
                <h3>Contatti</h3>

                <div class="top-list">
                  <a class="icon-link" href="mailto:ilblogdilujanta@gmail.com">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <rect x="3" y="5" width="18" height="14" rx="2"/>
                      <path d="M3 7l9 6 9-6"/>
                    </svg>
                    Email
                  </a>

                  <a class="icon-link" href="https://t.me/blogdilujanta" target="_blank">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <path d="M22 3L2 11l7 2 2 7 4-5 5 4z"/>
                    </svg>
                    Telegram
                  </a>

                  <a class="icon-link" href="https://t.me/ilblogdilujanta" target="_blank">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <path d="M22 3L2 11l7 2 2 7 4-5 5 4z"/>
                    </svg>
                    Canale Telegram
                  </a>

                  <a class="icon-link" href="https://independent.academia.edu/AlberoDaniela" target="_blank">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <circle cx="12" cy="12" r="9"/>
                      <path d="M3 12h18M12 3a15 15 0 0 1 0 18M12 3a15 15 0 0 0 0 18"/>
                    </svg>
                    Academia.edu
                  </a>
                </div>
              </section>
            </aside>
          </div>
        </section>
      </div>
    </main>

    <footer class="site-disclaimer" role="contentinfo">
   <!-- ✅ Banner Cookie -->
    <CookieBanner />

    <footer class="site-footer" aria-label="Note di copyright">
      <p>© 2016 — 2026 Il Blog di Lujanta – Ricerca, Memoria, Tradizione</p>

      <p>
        Tutti i contenuti di questo sito (testi, immagini, ricerche e materiali originali)
        sono protetti da diritto d’autore.
      </p>

      <p>
        È vietata la riproduzione totale o parziale senza autorizzazione.
        La citazione è consentita esclusivamente indicando chiaramente l’autrice e la fonte.
      </p>

      <nav class="footer-links" aria-label="Link legali">
        <a href="/privacy">Privacy Policy</a>
        <span>·</span>
        <a href="/cookie">Cookie Policy</a>
        <span>·</span>
        <button type="button" class="cookie-manage" data-cookie-manage>
          Gestisci cookie
        </button>
      </nav>
    </footer>

    <!-- ✅ Gestisci cookie -->
    <script is:inline define:vars={{ CONSENT_KEY }}>
      document.addEventListener("click", (e) => {
        const btn = e.target.closest("[data-cookie-manage]");
        if (!btn) return;
        try{ localStorage.removeItem(CONSENT_KEY); }catch(err){}
        window.location.reload();
      });
    </script>
    </footer>
  </body>
</html>
